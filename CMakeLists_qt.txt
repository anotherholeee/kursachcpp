cmake_minimum_required(VERSION 3.16)
project(kursovayacpp_qt VERSION 1.0.0 LANGUAGES CXX)

set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Поиск Qt6 или Qt5
set(CMAKE_AUTOMOC ON)
set(CMAKE_AUTOUIC ON)
set(CMAKE_AUTORCC ON)

# Попытка найти Qt6, если не найдено - ищем Qt5
find_package(Qt6 QUIET COMPONENTS Core Widgets)
if(Qt6_FOUND)
    message(STATUS "Найден Qt6")
    set(QT_VERSION_MAJOR 6)
else()
    find_package(Qt5 5.15 REQUIRED COMPONENTS Core Widgets)
    message(STATUS "Найден Qt5")
    set(QT_VERSION_MAJOR 5)
endif()

# Исходные файлы проекта
set(SOURCES
    main_qt.cpp
    qt_ui.cpp
    qt_ui.h
    exceptions.cpp
    stop.cpp
    time.cpp
    vehicle.cpp
    electric_transport.cpp
    fuel_transport.cpp
    tram.cpp
    trolleybus.cpp
    bus.cpp
    driver.cpp
    route.cpp
    trip.cpp
    journey.cpp
    algorithm.cpp
    journey_planner.cpp
    driver_schedule.cpp
    data_manager.cpp
    command.cpp
    commands.cpp
    transport_system.cpp
)

# Создание исполняемого файла
# Явно исключаем main.cpp и ui.cpp из сборки Qt версии
list(REMOVE_ITEM SOURCES main.cpp ui.cpp)
add_executable(kursovayacpp_qt ${SOURCES})

# Подключение Qt библиотек
if(QT_VERSION_MAJOR EQUAL 6)
    target_link_libraries(kursovayacpp_qt
        Qt6::Core
        Qt6::Widgets
    )
else()
    target_link_libraries(kursovayacpp_qt
        Qt5::Core
        Qt5::Widgets
    )
endif()

# Для Windows: дополнительные настройки
if(WIN32)
    target_compile_definitions(kursovayacpp_qt PRIVATE _WIN32_WINNT=0x0601)
    # Установка кодировки UTF-8 для Windows
    target_compile_definitions(kursovayacpp_qt PRIVATE UNICODE _UNICODE)
endif()

# Установка выходной директории (опционально)
set_target_properties(kursovayacpp_qt PROPERTIES
    WIN32_EXECUTABLE TRUE
)

